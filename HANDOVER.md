# TradeLog Pro V2 - 開発引き継ぎドキュメント

## 現在の状況
TradeLog Pro V2の主要なリファクタリング（Vanilla JSへの回帰、DOM操作の安全性向上、UI/UXの改善）がほぼ完了し、ロット計算機能のブラッシュアップを行っていました。

最終更新日: 2025/11/21

## 最近の変更点
1. **DOM操作の刷新**: `innerHTML` や `document.createElement` の乱雑な使用を廃止し、宣言的ヘルパー関数 `el` (`js/utils/dom.js`) を導入。
2. **ロット計算機能の大幅改善**:
   - 新しいカード式UI (`js/features/lot-calculator.js`)
   - リアルタイムレート取得 (`js/services/rate-service.js`)
   - 契約仕様の適正化（日経225, GOLD等）
   - 計算ロジックの精密化（小数点処理、最小ロット考慮）
3. **設定機能の復元**: ロット計算機とは別に、口座タイプやpips設定を管理する画面を復元。
4. **バグ修正**:
   - 他のタブ（記録、分析）へのCSS干渉を修正（スコープ化）。
   - レート取得失敗時の手動入力フォールバック実装。
   - 入力時のスクロール飛び対策（`onInput` -> `onChange` への変更など）。

## 残タスク・既知の問題

### 1. ロット計算機能
- **動作検証**: GOLDや日経225の計算結果が正しいか、実機（ブラウザ）での最終確認が必要。
- **入力UX**: `onChange` に変更したため、スライダー等のリアルタイム性が少し落ちている可能性がある。必要に応じて `onInput` に戻しつつフォーカス維持のロジック（`render`時のフォーカス復元）を実装する検討が必要。

### 2. マスコット機能 (`js/features/mascot/`)
- 基本的な実装は完了しているが、バッジ獲得時のインタラクションや進化ロジックの完全な統合は未確認。
- 画像アセットが `public/assets/images/mascot/` に正しく配置されているか確認が必要。

### 3. トレード編集機能
- 編集履歴（`edit_history`）が正しくSupabaseに保存・表示されるか確認が必要。
- マイグレーションSQL (`supabase/migrations/20251120_add_edit_history.sql`) の実行確認。

### 4. その他
- **テスト**: 自動テストが存在しないため、手動での網羅的なテストが必要。
- **コード品質**: `js/features/analytics/` 内の一部ファイルがまだ古い `innerHTML` パターンを使っている可能性があるため、統一を進める。

## ファイル構成（主要なもの）
- `js/app.js`: エントリーポイント、タブ管理。
- `js/utils/dom.js`: DOM生成ヘルパー `el`。
- `js/features/lot-calculator.js`: ロット計算 & 設定機能。
- `js/config/pairs-config.js`: 通貨ペア・商品定義。
- `js/services/rate-service.js`: レート取得サービス。
- `css/pages.css`: 各ページのスタイル（`.lot-calculator` スコープ等）。

## 次のステップへの推奨
1. ロット計算機能の徹底的なテスト（特にエッジケース：残高0、極端なレートなど）。
2. マスコット機能のビジュアル確認とアセット追加。
3. トレード記録・編集機能の通しテスト。

